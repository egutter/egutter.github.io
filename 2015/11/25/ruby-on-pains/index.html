
<!DOCTYPE html>
<html lang="en-us">

    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" Ruby On Pains &middot;  10 Pines Blog" />
        <meta property="og:site_name" content="10 Pines Blog" />
        <meta property="og:url" content="http://egutter.github.io/prueba-blog/2015/11/25/ruby-on-pains/" />

    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2015-11-25T15:28:11Z" />
        

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@" />
        <meta name="twitter:creator" content="@" />
        <meta name="twitter:title" content="Ruby On Pains" />
        <meta name="twitter:description" content="" />
        <meta name="twitter:url" content="http://egutter.github.io/prueba-blog/2015/11/25/ruby-on-pains/" />
    

        <title> Ruby On Pains &middot;  10 Pines Blog</title>

    
        <meta name="description" content="" />
    

        <meta name="p:domain_verify" content="fc173d84e3a4de948ed4bda2908afd3e"/>
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
        

    
        <link href="http://egutter.github.io/prueba-blog/index.xml" rel="alternate" type="application/rss+xml" title="10 Pines Blog" />
    

    
        <link rel="canonical" href="http://egutter.github.io/prueba-blog/2015/11/25/ruby-on-pains/" />

    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Ruby On Pains",
        "author": {
            "@type": "Person",
            "name": "http://profiles.google.com/?rel=author"
        },
        "datePublished": "2015-11-25",
        "description": "",
        "wordCount":  1305 
    }

    </script>

    <script type="text/javascript">
    
    
      var disqus_shortname = '10pinesblog';
      var disqus_identifier = 'http:\/\/egutter.github.io\/prueba-blog\/2015\/11\/25\/ruby-on-pains\/';
      var disqus_title = 'Ruby On Pains';
      var disqus_url = 'http:\/\/egutter.github.io\/prueba-blog\/2015\/11\/25\/ruby-on-pains\/';
    

    </script>
    

    <style>
@charset "UTF-8";article,header,img,main,nav,section{display:block}blockquote,p,pre,ul{margin:2em auto}#wrapper,pre{width:100%;box-sizing:border-box}#nav,#wrapper,code{position:relative}#nav,body{background:#fff}#menu,blockquote,pre code{background:0 0}#menu,#menu .menu-header,#menu .menu-list,#wrapper,.post-nav .post-nav-item .post-nav-teaser .post-nav-info,blockquote,pre{box-sizing:border-box}img{border:0;max-width:100%;height:auto;margin:2.5em auto}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}code,pre{font-family:monospace,monospace;font-size:1em}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:300;src:local("Merriweather Sans Light"),local("MerriweatherSans-Light"),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowY_zIojJi0m4a5Z6tRh6itY.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:400;src:local("Merriweather Sans Regular"),local("MerriweatherSans-Regular"),url(//fonts.gstatic.com/s/merriweathersans/v5/AKu1CjQ4qnV8MUltkAX3sL2aU247V0zTzydO4RoO9Ok.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:700;src:local("Merriweather Sans Bold"),local("MerriweatherSans-Bold"),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowQfd-b-I5PxxcmB4_-MNcqw.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:800;src:local("Merriweather Sans ExtraBold"),local("MerriweatherSans-ExtraBold"),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowWT7sFQ1Iz1BbpcuCPlgc9Q.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:300;src:local("Merriweather Sans Light Italic"),local("MerriweatherSans-LightItalic"),url(//fonts.gstatic.com/s/merriweathersans/v5/nAqt4hiqwq3tzCecpgPmVX9UU5BmOJGkLxUCVv5VXdc.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:400;src:local("Merriweather Sans Italic"),local("MerriweatherSans-Italic"),url(//fonts.gstatic.com/s/merriweathersans/v5/3Mz4hOHzs2npRMG3B1ascf0KIgDhPIHb_R-SWdtqte8.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:700;src:local("Merriweather Sans Bold Italic"),local("MerriweatherSans-BoldItalic"),url(//fonts.gstatic.com/s/merriweathersans/v5/nAqt4hiqwq3tzCecpgPmVYM8pfYvjMoOxygpzLVILAs.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-weight:400;src:local("Inconsolata"),url(//fonts.gstatic.com/s/inconsolata/v12/BjAYBlHtW3CJxDcjzrnZCIbN6UDyHWBl620a-IRfuBk.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-weight:700;src:local("Inconsolata Bold"),local("Inconsolata-Bold"),url(//fonts.gstatic.com/s/inconsolata/v12/AIed271kqQlcIRSOnQH0yTqR_3kx9_hJXbbyU8S6IN0.woff) format("woff")}@font-face{font-family:icons;src:url(/fonts/icons.eot?9273991);src:url(/fonts/icons.eot?9273991#iefix) format("embedded-opentype"),url(/fonts/icons.woff?9273991) format("woff"),url(/fonts/icons.ttf?9273991) format("truetype"),url(/fonts/icons.svg?9273991#icons) format("svg");font-weight:400;font-style:normal}[class^=icon-]:before{font-family:icons;font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-arrow-left:before{content:'\e804'}.icon-arrow-right:before{content:'\e807'}.icon-rss:before{content:'\e808'}.icon-menu:before{content:'\e809'}body{margin:0;font:300 1em/1.5em 'Merriweather Sans',sans-serif;color:#595B66}blockquote,i{font-style:italic}code,pre{font-family:Inconsolata,monospace}a,blockquote,code,i{font-weight:400}::-moz-selection{color:#222;background:#D6EDFF;text-shadow:none}::-moz-selection,::selection{color:#222;background:#D6EDFF;text-shadow:none}a{background-color:transparent;color:inherit;text-decoration:none;transition:all ease-out .2s}.post-content a{border-bottom:2px solid #36D995}h1,h4{text-rendering:optimizeLegibility;color:#1F2026}h1{font-size:2em;line-height:1em;margin:2em 0 -.5em}h4{font-size:1.25em;line-height:1.2em;margin:2.4em 0 -.8em}ul{list-style:none;padding-left:3em}blockquote{padding:0 1em;border-left:.25em solid #D4D5D9;color:#595B66}blockquote *{margin:1em auto}blockquote :first-child{margin-top:0}blockquote :last-child{margin-bottom:0}i{color:#363740}code{display:inline-block;top:-1px;padding:3px 6px;margin:-1px 2px;font-size:.875em;line-height:1.143em;background:#E1E2E6;color:#000;border-radius:2px}pre{padding:1em;white-space:pre;overflow:auto;background:#9D9FA6;color:#fff}pre code{position:static;top:auto;font-size:1em;line-height:1.5em;white-space:-moz-pre-wrap;white-space:pre-wrap;vertical-align:inherit;border:none;padding:0}#menu .menu-header:before,.post .post-title:before{border-bottom:4px solid #36D995;content:''}.inner{max-width:48em;margin:0 auto;padding:0 1em}#wrapper{min-height:100vh;padding-bottom:6em;background:#F2F3F5}#push{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;opacity:1}#nav{z-index:70;transition:all ease-out .4s;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;opacity:1}#nav:after{clear:both;content:'';display:table}#nav .nav-logo{float:left;height:2em;padding:1em;max-width:50%}#nav .nav-logo img{width:auto;max-width:none;height:2em;margin:0}#nav .nav-menu{float:right}#nav .nav-menu:after{clear:both;content:'';display:table}#nav .nav-menu a{display:block;width:1em;height:1em;line-height:1em;padding:1.5em;text-align:center;float:left;cursor:pointer}#nav .nav-menu a i:before{margin:auto}#menu{display:none;position:fixed;left:50%;top:5%;width:30em;height:90%;margin-left:-15em;padding:3em 0 0;overflow:hidden;transition:all ease-out .3s;-webkit-transform:translate3d(0,2em,0);transform:translate3d(0,2em,0);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;opacity:0;z-index:100}@media only screen and (max-width:50em){#menu{width:90%;left:5%;margin-left:auto}}#menu .menu-header{position:absolute;left:0;top:0;width:100%;height:3.5em;padding:1em 1.5em .5em;margin-bottom:1em;line-height:2em;z-index:110;background:#fff}#menu .menu-header:before{position:absolute;left:-5%;bottom:-1em;width:110%;height:2em;background:#fff;box-shadow:0 .125em .125em rgba(0,0,0,.1);-webkit-transform:rotate(2.5deg);transform:rotate(2.5deg);transition:all ease-out .2s;z-index:115}#menu .menu-header:after{clear:both;content:'';display:table}#menu .menu-header .menu-label{position:relative;display:block;float:left;z-index:120}#menu .menu-header .menu-close{position:relative;display:block;float:right;width:2em;height:2em;padding:1em;margin:-1em -1.5em -1em 0;cursor:pointer;z-index:125}#menu .menu-header .menu-close:after,#menu .menu-header .menu-close:before{content:'';position:absolute;left:50%;top:50%;background:#9D9FA6;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.overlay,.overlay:before{top:0;width:100%;height:100%}#menu .menu-header .menu-close:after{width:2px;height:1em;margin:-.5em 0 0 -1px}#menu .menu-header .menu-close:before{width:1em;height:2px;margin:-1px 0 0 -.5em}#menu .menu-list{position:relative;list-style:none;margin:0;padding:2em 0;height:100%;overflow-x:hidden;overflow-y:scroll;background:#fff}.overlay{position:fixed;left:0;z-index:80;display:none}.overlay:before{content:'';position:absolute;left:0;background:#1F2026;opacity:0;transition:all ease-out .3s;-webkit-transform-style:preserve-3d;transform-style:preserve-3d}.post{position:relative;z-index:20}.post .post-meta{display:block;font-size:.75em;line-height:1.334em;font-weight:400;margin-bottom:1.334em}.post .post-title{position:relative;color:#000;font-size:2em;line-height:1.375em;font-weight:800;text-indent:-1px;margin:.25em 0 .75em}.post .post-title:before{position:absolute;left:0;bottom:-.334em;width:1em;margin-bottom:-2px}.post .post-header{padding:4em 0 0;margin-bottom:3em}.post-footer .post-share a span{display:none}.post-nav .post-nav-item{position:fixed;top:50%;display:block;margin-top:-4em;overflow:hidden;border-radius:10em;transition:none}@media only screen and (max-width:70em){.post-nav .post-nav-item{position:absolute;top:auto;margin:auto;max-width:50%}}.post-nav .post-nav-item.post-nav-next{left:0;text-align:left}.post-nav .post-nav-item.post-nav-next .post-nav-icon{float:left}.post-nav .post-nav-item.post-nav-next .post-nav-icon i{left:-.05em}.post-nav .post-nav-item.post-nav-next .post-nav-info{padding-left:6em}.post-nav .post-nav-item.post-nav-prev{right:0;text-align:right}.post-nav .post-nav-item.post-nav-prev .post-nav-icon{float:right}.post-nav .post-nav-item.post-nav-prev .post-nav-icon i{right:-.05em}.post-nav .post-nav-item.post-nav-prev .post-nav-info{padding-right:6em}.post-nav .post-nav-item .post-nav-teaser{display:block;padding:1em;transition:all ease-out .2s;max-width:25em;overflow:visible}.post-nav .post-nav-item .post-nav-teaser:after{clear:both;content:'';display:table}.post-nav .post-nav-item .post-nav-teaser .post-nav-icon{display:block;width:5em;height:5em;line-height:5em;text-align:center;box-sizing:border-box;border-radius:10em;border:1px solid #36D995;box-shadow:0 0 0 0 transparent;transition:all ease-out .1s;background:#F2F3F5}.post-nav .post-nav-item .post-nav-teaser .post-nav-icon i{position:relative;font-size:2em}@media only screen and (max-width:30em){.post-nav .post-nav-item .post-nav-teaser .post-nav-icon{width:4em;height:4em;line-height:4em}.post-nav .post-nav-item .post-nav-teaser .post-nav-icon i{font-size:1.5em}}.post-nav .post-nav-item .post-nav-teaser .post-nav-icon i:before{margin:auto}.post-nav .post-nav-item .post-nav-teaser .post-nav-info{display:none;width:100%;transition:all ease-out .2s}.post-nav .post-nav-item .post-nav-teaser .post-nav-info .post-nav-title{display:block;max-height:1.25em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin:1.25em 0 .25em;font-size:1em;line-height:1.25em;font-weight:700;color:#363740}.post-nav .post-nav-item .post-nav-teaser .post-nav-info .post-nav-excerpt{display:block;max-height:1.334em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin:0;font-size:.75em;line-height:1.334em;font-weight:400;color:#9D9FA6}
</style>


    </head>
    <body class="home-template" style="display: none;">
      <section id="wrapper">
        <div id="ajax-container">
          <nav id="nav" class="nav">
            <div class="nav-logo">
              <a href="http://egutter.github.io/prueba-blog/">
      			  	
      			  	
      			  	<img src="http://egutter.github.io/prueba-blog/images/10p-logo.png" alt="Logo"/>
      			  	
              </a>
			  	    
            </div>
            <div class="nav-menu">
              <a class="rss" href="">
                <i class="icon-rss"></i>
              </a>
                
                <a class="menu" data-action="toc" data-target="toc"><i class="icon-location"></i></a>
                
                
            </div>
          </nav>


<main class="content" role="main">
	<article class="post">
		<div class="inner">

			<div id="push">

  			<header class="post-header">
  				<span class="post-meta">
						<span class="post-date">25 Nov 2015</span> <span class="reading-time">| <span class="estimated-reading-time">7 min.</span> (<span class="word-count">1305</span> words)</span></span>
  				</span>
  				<div class="clear"></div>
  				<h1 class="post-title">Ruby On Pains</h1>
  			</header>

  			<section class="post-content">
  				

<p>Have you ever heard about the <em>Rails way</em>?
I would like to introduce some pains that I&rsquo;ve seen and keep seeing in all the Rails projects due to the <em>Rails way</em>&hellip;</p>

<h2 id="activerecord">ActiveRecord</h2>

<p>How many times do we need to find an object in a Rails project? How many times do we create, update or delete objects from the DB? Many times, isn&rsquo;t it? We are used to repeat these actions in all our ActiveRecord classes. We do it like monkeys, never ask for a timeout and think about it. It seems to be something <em>normal</em> when we use this framework, it&rsquo;s the famous <em>Rails way</em>. It&rsquo;s <em>normal</em> for us to have a class that answers <code>find</code>, <code>update</code>, <code>save</code>, etc, but we never think if it’s right and whether there could be a better way of doing it.</p>

<p>It&rsquo;s typical to find this kind of logic in a Rails project, see the example of this controller:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">UserController</span>
  <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">index</span>
    <span style="color: #f8f8f2">@users</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">User</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">all</span>
  <span style="color: #66d9ef">end</span>
  
  <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">show</span>
    <span style="color: #f8f8f2">@user</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">User</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">find(params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:id</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span>
  <span style="color: #66d9ef">end</span>
    
  <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">create</span>
    <span style="color: #f8f8f2">@user</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">User</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">create(user_params)</span>
  <span style="color: #f92672">...</span>
  <span style="color: #66d9ef">private</span>
 
  <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">user_params</span>
    <span style="color: #f8f8f2">params</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">require(</span><span style="color: #e6db74">:user</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">permit(</span><span style="color: #f92672">...</span><span style="color: #f8f8f2">)</span>
  <span style="color: #66d9ef">end</span>
  <span style="color: #f92672">...</span>
</pre></div>


<p>The OO paradigm defines, among other things, that a class has two main responsibilities. The first one is defining the behavior for the objects of that class, and the second one is creating instances of it. This means that all objects that are instances of the same class can perform the same actions. So, when did we talk about persisting? We didn&rsquo;t say anything about classes having the responsibility of writing to the database or executing a query in order to load some instances in memory. Have you ever thought what are we doing to our classes in order to answer those kind of messages? Basically inheriting from <code>ActiveRecord::Base</code>, which is a strong association that defines a rigid behavior that doesn&rsquo;t follow the paradigm principles. Look at this alternative:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">UserController</span>
  <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">index</span>
    <span style="color: #f8f8f2">@users</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">UserRecords</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">find_all</span>
  <span style="color: #66d9ef">end</span>
  
  <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">show</span>
    <span style="color: #f8f8f2">@user</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">UserRecords</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">find(params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:id</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span>
  <span style="color: #66d9ef">end</span>
  <span style="color: #f92672">...</span>
</pre></div>


<p>Definitely our business domain models shouldn&rsquo;t be coupled to the way we persist them. The main reason is both belong to different domains, having different kind of responsibilities. Moreover, have you ever thought about changing Rails for another framework? Our models shouldn&rsquo;t change, our code shouldn&rsquo;t change much. We should only need to change those entities in charge of persistence. But if those entities are the same that model our business domain, probably we are in trouble.</p>

<h2 id="validations">Validations</h2>

<p>Have you ever thought about invalid objects? Moreover, have you ever thought if it make sense to think about valid objects? Well, in real life we don&rsquo;t have invalid entities, we don&rsquo;t have invalid persons, or invalid cars, it would be ridiculous. But, since the external world interacts with computer systems, for example someone using a web application, we can always do it in a bad way. We can fill forms incorrectly, e.g. filling a telephone input field with my name. However this doesn&rsquo;t mean that invalid objects should exist. We can have validations or rules that need to be satisfied in order to process that form and create a new user in our system.</p>

<p>Let me be more specific. In a Rails project we can probably find controllers like&hellip;</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">create</span>
  <span style="color: #f8f8f2">@user</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">User</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">create(params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:user</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span>
  <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">@user</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">valid?</span>
    <span style="color: #f8f8f2">redirect_to</span> <span style="color: #f8f8f2">show_path(@user)</span>
  <span style="color: #66d9ef">else</span>
    <span style="color: #f8f8f2">render</span> <span style="color: #e6db74">:create</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">errors</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">@user</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">errors</span>
  <span style="color: #66d9ef">end</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>We usually ask an object if it&rsquo;s valid because, I suppose, it&rsquo;s the <em>Rails way</em>. As I said, it&rsquo;s ridiculous, I&rsquo;m sure that User class is full of <code>validates</code> and we still can create invalid instances.</p>

<p>Suppose we are in 1930, and you go to a club asking for a sign up. The help desk gives you the users record book and asks you to write your enrollment, then the help desk checks whether you have filled the enrollment correctly. If you did it wrong, you will be asked to fix it. Well, I&rsquo;m sure that book would be full of corrections. Wouldn&rsquo;t it be better to have a sign up form that the helpdesk uses to complete an enrollment that we know is correct?</p>

<p>The problem here is that we are modeling a user when we don&rsquo;t have to. We are omitting something in the middle, the form. We aren&rsquo;t modeling that, take a look at this short example:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">create</span>
  <span style="color: #f8f8f2">form</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">UserEnrollmentForm</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new(user_params)</span>
  <span style="color: #f8f8f2">@user</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">UserEnroller</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">call(form)</span>
  <span style="color: #f8f8f2">redirect_to</span> <span style="color: #f8f8f2">show_path(@user)</span>
<span style="color: #66d9ef">rescue</span> <span style="color: #66d9ef">UserEnrollmentError</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">e</span>
  <span style="color: #f8f8f2">render</span> <span style="color: #e6db74">:create</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">form</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">form,</span> <span style="color: #e6db74">error</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">e</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>Here we are just delegating the responsibility of deciding whether to create or not a User based on an input form. Again, have in mind the given implementation is not part of the scope, we can discuss multiple ways of doing this. The main thing is, we should never have invalid objects in our system. If something goes wrong while creating or modifying an instance, I would like to be notified asap - In Rails, use the bang always!</p>

<h2 id="ruby-coals">Ruby Coals</h2>

<p>I like using that word just to refer to awful gems. What happens when you grab a coal? Your hands get dirty right? Well, this is what I feel with some gems when I start using them in a project. Also a coal is the primitive of a gem and it really feels like we are not progressing when we use that kind. The fact is that the <em>Rails way</em> is awesome cause we can find some functionality that someone has already built, installing that gem, and voilá.</p>

<p>Let&rsquo;s see some examples. We can start with this pagination coal&hellip;</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Post</span>
  <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">per_page</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">10</span>
<span style="color: #66d9ef">end</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">PostsController</span>
  <span style="color: #f92672">...</span>
  <span style="color: #f8f8f2">@posts</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">Post</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">paginate(</span><span style="color: #e6db74">page</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:page</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f92672">...</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>I don&rsquo;t like that way of doing things, we are breaking the OO design rule about responsibilities and not coupling things that belong to different domains. Here, we are coupling our <code>Post</code> model with the idea of paginating them for a view, that&rsquo;s crazy! We should find a better way, such as modeling a paginator instead of having our classes answering messages like <code>per_page</code> or <code>paginate</code>:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">PostsController</span>
  <span style="color: #f92672">...</span>
  <span style="color: #f8f8f2">paginator</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">Paginator</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new(</span><span style="color: #66d9ef">PostsBook</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">find_all,</span> <span style="color: #e6db74">per_page</span><span style="color: #f8f8f2">:</span> <span style="color: #66d9ef">POSTS_PER_PAGE</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">posts</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">paginator</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">call(</span><span style="color: #e6db74">page</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:page</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f92672">...</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>Now take a look at this filtering coal&hellip;</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Student</span>
  <span style="color: #f8f8f2">scope</span> <span style="color: #e6db74">:with_country_id</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">(country_id)</span> <span style="color: #f8f8f2">{</span> <span style="color: #960050; background-color: #1e0010">…</span> <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">scope</span> <span style="color: #e6db74">:sorted_by</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">(field)</span> <span style="color: #f8f8f2">{</span> <span style="color: #f92672">...</span> <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">scope</span> <span style="color: #e6db74">:search_query</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">...</span>
      
  <span style="color: #f8f8f2">filterrific(</span>
    <span style="color: #e6db74">default_filter_params</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">{</span> <span style="color: #e6db74">sorted_by</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;created_at_desc&#39;</span> <span style="color: #f8f8f2">},</span>
    <span style="color: #e6db74">available_filters</span><span style="color: #f8f8f2">:</span> <span style="color: #f92672">[</span><span style="color: #e6db74">:sorted_by</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:search_query</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:with_country_id</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f92672">...</span>
<span style="color: #66d9ef">end</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">StudentController</span>
  <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">index</span>
    <span style="color: #f8f8f2">@filterrific</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">initialize_filterrific(</span><span style="color: #66d9ef">Student</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:filterrific</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">or</span> <span style="color: #66d9ef">return</span>
    <span style="color: #f8f8f2">@students</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">@filterrific</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">find</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">page(params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:page</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">respond_to</span> <span style="color: #66d9ef">do</span> <span style="color: #f92672">|</span><span style="color: #f8f8f2">format</span><span style="color: #f92672">|</span>
      <span style="color: #f8f8f2">format</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">html</span>
      <span style="color: #f8f8f2">format</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">js</span>
    <span style="color: #66d9ef">end</span>
  <span style="color: #66d9ef">end</span>
  <span style="color: #f92672">...</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>That&rsquo;s really good! Our models become a storage of filtering configuration! Seriously, the filtering functionallity that we offer in a view has nothing to do in our <code>Student</code> model. Does a student need to know about filtering configuration? One more time, we are coupling. Here is another simple way of doing this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">StudentController</span>
  <span style="color: #f92672">...</span>
    <span style="color: #f8f8f2">students_filter</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">StudentsFilter</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new(params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:filtering</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">@students</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">StudentRecords</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">with_filter(filter)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">find_all</span>
  <span style="color: #f92672">...</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>Again, let me remeber that the examples shown above are just ilustrative, we are not discussing the implementation, but the approach we are choosing. My suggestion is, let&rsquo;s think twice before adding this kind of coals as your code will get dirty and removing or refactoring this kind of functionality to another place will be a pain in the ass.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In my opinion, Rails is a good framework for a kick-off. It’s easy to write the firsts test cases, implement the idea, and deploy it. But, what happens when the application starts to grow? Sometimes we lose our mind trying to get things out faster, and we shouldn&rsquo;t forget the importance of designing good models, otherwise implementing the next feature becomes a headache. Also you will always find multiple gems to solve your problem, but think the way you are going to implement such thing, most of them make your models dirty. Always remember that it is key to understand the essence of the objects in the reality&rsquo;s domain to keep it on our code.</p>

  			</section>

  			<footer class="post-footer">
  				<div class="post-tags">
            
  				</div>
  				<div class="post-share">
  					<a class="icon-twitter" href="https://twitter.com/share?text=Ruby%20On%20Pains&url=http%3a%2f%2fegutter.github.io%2fprueba-blog%2f2015%2f11%2f25%2fruby-on-pains%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
  						<span>Twitter</span>
  					</a>
  					<a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fegutter.github.io%2fprueba-blog%2f2015%2f11%2f25%2fruby-on-pains%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
  						<span>Facebook</span>
  					</a>
  					<a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fegutter.github.io%2fprueba-blog%2f2015%2f11%2f25%2fruby-on-pains%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
  						<span>Google+</span>
  					</a>
  				</div>
  			</footer>

  			<aside class="post-comments">
    
    
    <div id="disqus_thread"></div>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
    
</aside>


			</div>

			<nav class="post-nav">
				
					<a class="post-nav-item post-nav-next" href="http://egutter.github.io/prueba-blog/2016/01/04/there-are-null-reasons/">
						<section class="post-nav-teaser">
							<span class="post-nav-icon"><i class="icon-arrow-left"></i></span>
							<span class="post-nav-info">
								<h4 class="post-nav-title">There are null reasons</h4>
								<p class="post-nav-excerpt">&hellip;</p>
							</span>
						</section>
					</a>
				
				
					<a class="post-nav-item post-nav-prev" href="http://egutter.github.io/prueba-blog/2015/11/02/learning-programming/">
						<section class="post-nav-teaser">
							<span class="post-nav-icon"><i class="icon-arrow-right"></i></span>
							<span class="post-nav-info">
								<h4 class="post-nav-title">Learning Programming</h4>
								<p class="post-nav-excerpt">&hellip;</p>
							</span>
						</section>
					</a>
				
				<div class="clear"></div>
			</nav>

		</div>
	</article>
</main>

				<div id="body-class" style="display: none;"></div>
				<footer id="footer">
					<section class="credits">
						<span class="credits-theme">Theme <a href="https://github.com/zenithar/hugo-theme-bleak" target="_blank" rel="nofollow">Bleak</a> by <a href="http://zutrinken.com" target="_blank" rel="nofollow">zutrinken</a></span>
						<span class="credits-software">Published with <a href="http://gohugo.io" target="_blank" rel="nofollow">Hugo</a></span>
					</section>
				</footer>
				
				
<div id="tocMenu" data-target="toc">
    <div class="menu-header">
        <span class="menu-label">Menu</span>
        <a class="menu-close" data-action="toc" data-target="toc"></a>
    </div>
    <div id="toc" class="menu-list">
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#activerecord">ActiveRecord</a></li>
<li><a href="#validations">Validations</a></li>
<li><a href="#ruby-coals">Ruby Coals</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>


				<div class="overlay"></div>
			</div>
		</section>

    <script>
      (function(c,f){asyncLoader=function(i,h){i.foreach(function(k,j){e(j,d(j),h)});if(typeof h.callback=="function"){var g=setInterval(function(){if(f.readyState==="complete"){clearInterval(g);h.callback()}},10)}};var d=function(g){var h=g.split(".");return h[h.length-1]},e=function(h,i,g){switch(i){case"js":a(h,g);break;case"css":b(h);break;default:break}},a=function(i,h){var g=document.createElement("script");g.type="text/javascript";g.async=true;g.src=i;document.getElementsByTagName("head")[0].appendChild(g)},b=function(g){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";h.href=g;document.getElementsByTagName("head")[0].appendChild(h)};Array.prototype.foreach=function(h){for(var g=0;g<this.length;g++){h(g,this[g])}}})(this,document);

      asyncLoader([
				"/js/dependencies.js",
				"/css/dependencies.css"
      ],{
        callback:function(){
					asyncLoader([
						"/css/style.css",
						"/js/script.js"
					], {
						callback: function() {
							$('body').fadeIn( 800 );
						}
					});
        }
      });

</script>



</body>
</html>

