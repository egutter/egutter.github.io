<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
  <title>Java generics and inheritance (part 1)</title>
  <link href="https://egutter.github.io/prueba-blog/css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="https://egutter.github.io/prueba-blog/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
  <style type="text/css">
  
    footer.page-footer{background-image: url(https://egutter.github.io/prueba-blog/images/default.png);}
  
  </style>
</head>
<body>
  <ul id="slide-out" class="side-nav">
    <li><a href="https://egutter.github.io/prueba-blog"><i class="mdi-action-home left"></i>Home<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
    <li><a href="https://egutter.github.io/prueba-blog/categories"><i class="mdi-action-perm-media left"></i>Categories<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
    <li><a href="https://egutter.github.io/prueba-blog/tags"><i class="mdi-action-loyalty left"></i>Tags<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
  </ul>
  <div id="index-banner" class="parallax-container">
  <a data-activates="slide-out" class="btn-floating button-collapse" style="top: 5px; left: 5px;"><i class="mdi-navigation-menu"></i></a>
    <div class="section no-pad-bot">
      <div class="container">
        
        <h1 class="header center teal-text text-lighten-2">10 Pines Blog</h1>
        <div class="row center">
          <h5 class="header col s12 light"></h5>
        </div>
        <div class="row center">
        
        
        
          <a href="https://www.facebook.com/10Pines"><img src="https://egutter.github.io/prueba-blog/images/facebook-dreamstale25.png"></a>
        
        
        
        
          <a href="https://www.linkedin.com/in/10Pines"><img src="https://egutter.github.io/prueba-blog/images/linkedin-dreamstale45.png"></a>
        
          <a href="https://egutter.github.io/prueba-blog/index.xml"><img src="https://egutter.github.io/prueba-blog/images/feed-dreamstale27.png"></a>
        </div>
      </div>
    </div>
    <div class="parallax">
    
      <img src="https://egutter.github.io/prueba-blog//images/10pines-background.jpg">
    
    </div>
  </div>



<div class="container">
  <div class="section">

    <div class="row">
      <div class="col s12">
        <div class="card-panel">
          <h4>Java generics and inheritance (part 1)</h4>
          <p>
          
            
              <a href="https://egutter.github.io/prueba-blog/categories/java/">java</a>
            
              <a href="https://egutter.github.io/prueba-blog/categories/generics/">generics</a>
            
              <a href="https://egutter.github.io/prueba-blog/categories/oop/">oop</a>
            
              <a href="https://egutter.github.io/prueba-blog/categories/reflection/">reflection</a>
            
           
          </p>
          <p>

<h2 id="types-sets-variables-and-casting">Types, Sets, variables and casting</h2>

<p>When you use a compile-time typed language, like Java, you expect that types in each variable will help you by restricting the possibilities for a value. Instead of being able to do everything, you want to do things that are valid in your domain.</p>

<p>Discussions aside about strong vs weak typing, when you code with types you think of types as sets. A variable can be one of the elements of the implicit set for its type. Thus <code>Integer a</code> means that variable <em>&lsquo;a&rsquo;</em> will be one of the elements in the Integer set, and only that.<br />
If you have a <em>String</em> variable <em>&lsquo;a&rsquo;</em> and want to assign its value to a variable <em>&lsquo;b&rsquo;</em> of type <em>Object</em>:</p>

<pre><code class="language-java">String a = &quot;A&quot;;
Object b = a;
</code></pre>

<p>The compiler does an implicit up-casting and you expect that to be a valid operation. The set of <em>Object</em> instances is a super-set of <em>String</em> instances. That is basically because Object is a superclass of String and inheritance implies set inclusion.<br />
But once you upcast, you lose specificity. Your set of possibilities gets bigger and you can&rsquo;t ensure that <em>&lsquo;b&rsquo;</em> will always be a <em>String</em>. The value of variable <em>&lsquo;b&rsquo;</em> could be the <em>String</em> a, or could be something completely different like the number 1, that belongs to the <em>Integer</em> set.</p>

<p>{% img center /images/java-generics-and-inheritance-part-1-VennDeObjectString.jpg &ldquo;Venn diagram of objects&rdquo; %}</p>

<p>So far, I haven&rsquo;t told you anything new.</p>

<h2 id="what-s-wrong-with-generics">What&rsquo;s wrong with generics?!</h2>

<p>If you use Java generics, it&rsquo;s fairly probable that you have tried this example wondering what is wrong with the compiler:</p>

<pre><code class="language-java">List&lt;String&gt; stringList = new ArrayList&lt;&gt;();
List&lt;Object&gt;objectList = stringList; 	//error: cannot convert from List&lt;String&gt; to List&lt;Object&gt;
</code></pre>

<p>If <code>List&lt;Object&gt;</code> is the set of all lists that have objects inside, then List<String> should be a subset, right? We are just using intuition, but the compiler complains about it.<br />
To complicate things worse, the compiler will accept that same reasoning for arrays:</p>

<pre><code class="language-java">        String[] stringArray = new String[0];
        Object[] objectArray = stringArray;
</code></pre>

<p>Why can arrays be assigned and lists cant&rsquo;t? Have you ever dedicated some thoughts to it? They are both container types, they have both just one element type. What makes those types conceptually different?</p>

<p><img src="https://egutter.github.io/prueba-blog/images/java-generics-and-inheritance-part-1-genericsYUNo.jpg" alt="Generics YU" /></p>

<h2 id="the-reason">The reason</h2>

<p>Reading the authors of generics you can find a very good reason for it. Remember, at that time, they were trying to generify collections (having only java 1.4 on their hands).<br />
If you allow a list of strings to be upcasted to a list of objects and operated as a list of objects, you can do something like:</p>

<pre><code class="language-java">  List&lt;String&gt; stringList = new ArrayList&lt;String&gt;();
  List&lt;Object&gt; objectList = stringList;  // Let's pretend this is possible
  objectList.add(1); // Hey, 1 is not a String!
  String element = stringList.get(0); // Wonder what will happen...
</code></pre>

<p>Since it&rsquo;s an object list, why can&rsquo;t you just put a number inside. It&rsquo;s an object right? And what happens when the reference to that same list instance but with a <code>List&lt;String&gt;</code> type tries to get the added element?</p>

<pre><code class="language-java">String element = stringList.get(0);
</code></pre>

<p>Yeah! KaBoom. ClassCastException!<br />
Wait, what? Why do I have a cast exception if I&rsquo;m not even casting?<br />
To understand what&rsquo;s is going on, we need to see the implicit code there. When you use generics you have what they called <em>&ldquo;erasure&rdquo;</em>: the compiler modifies your code and some of the generic information is lost. This is the actual runtime code:</p>

<pre><code class="language-java">String element = (String) stringList.get(0);
</code></pre>

<p>You are not only casting, you are down-casting (which it&rsquo;s not runtime-safe). The return type of get() method, in runtime, is <em>Object</em>, not <em>String</em>. That&rsquo;s why, in runtime, you need to downcast to String.<br />
The compiler does it for you, but at the cost of assuming that the list only contains <em>Strings</em>. That assumption can be made at compile time if you avoid addition of other non <em>String</em> objects. How do they do that?</p>

<p><strong>At compile time, let&rsquo;s not allow the list to be used for anything else than <em>Strings</em>. So list of objects is out of the question.</strong>
There are, of course, other solutions to this problem (see <a href="http://en.wikipedia.org/wiki/Covariance_and_contravariance_%28computer_science%29">Covariance and Contravariance</a> ) but we will stick to Java solution in this article.</p>

<p>If you know what you are doing, there&rsquo;s one way to workaround this <em>generics</em> restriction. To see it graphically at compile time, we have three types <code>List&lt;String&gt;</code>, <code>List&lt;Object&gt;</code> and <code>List</code> which is the &ldquo;raw&rdquo; type, represented as sets:</p>

<p><img src="https://egutter.github.io/prueba-blog/images/java-generics-and-inheritance-part-1-VennListObjectListString.jpg" alt="Venn diagram of lists" /></p>

<p>The only way to escape this rule, at compile time, is to move to the super-set, and then go down to the other sub-set.</p>

<pre><code class="language-java">List&lt;String&gt; stringList = new ArrayList&lt;String&gt;();
List&lt;Object&gt; objectList = (List)stringList;  // no error
</code></pre>

<p>Fool the compiler by up-casting to <code>List</code> so it doesn&rsquo;t know which kind of elements is in the list, and then down-cast to <code>List&lt;Object&gt;</code> which is accepted. Why is that allowed and <code>(List&lt;Object&gt;)stringList</code> isn&rsquo;t, it&rsquo;s out of my grasp.<br />
Just to warn you: if you manage to do this, you may have <em>ClassClassExceptions</em> in runtime.</p>

<h2 id="but-arrays">But arrays!</h2>

<p><a href="https://egutter.github.io/prueba-blog/2014/12/02/java-generics-and-inheritance-part-2">On the next part of this article</a>, I&rsquo;ll show you why this doesn&rsquo;t happen with arrays, and the implications for reflection.</p>
</p>
          <p>2 Dec 2014
            
          </p>
          
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col s3 m1">
      
        <a class="btn-floating btn-large waves-effect waves-light" href="https://egutter.github.io/prueba-blog/2014/12/02/java-generics-and-inheritance-part-2/"><i class="mdi-navigation-arrow-back"></i></a>
      
      </div>
      <div class="col s6 m10 center">&nbsp</div>
      <div class="col s3 m1">
      
        <a class="btn-floating btn-large waves-effect waves-light" href="https://egutter.github.io/prueba-blog/2014/11/07/mvps-the-real-deal/"><i class="mdi-navigation-arrow-forward"></i></a>
      
      </div>
    </div>

  </div>
</div>

  <footer class="page-footer">
    <div class="footer-copyright">
      <div class="container">
      
      <div class="right">Design <a class="grey-text text-lighten-4" href="http://pdevty.github.io/blog/">pdevty</a></div>
      </div>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://egutter.github.io/prueba-blog/js/materialize.min.js"></script>
  <script src="https://egutter.github.io/prueba-blog/js/init.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  </body>
</html>

